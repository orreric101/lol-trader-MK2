import pandas as pd
from scipy.signal import savgol_filter
import ta
'''
hist_data = pd.read_csv('data.csv')
print(hist_data.shape)
hist_data['sav gol'] = savgol_filter(hist_data['Close'], 25, 3)  # window size 51, polynomial order 3
print(hist_data.shape)

live_data = pd.read_csv('live data BTCUSDT.csv')
print(live_data.shape)
live_data['sav gol'] = savgol_filter(live_data['c'], 25, 3)  # window size 51, polynomial order 3
print(live_data.shape)
'''


def dict_values(l):
    return list(l)


data = pd.read_csv('live data BTCUSDT.csv').iloc[1440:]

# x = [dict_values([1655158740000, 1655158799999, 'BTCUSDT', '1m', 1404316010, 1404317097, '22938.88000000', 22879.52, '22939.11000000', '22879.51000000', '63.64296000', 1088, True, '1457566.17167060', '31.19835000', '714468.63809340', '0']), dict_values([1655158800000, 1655158859999, 'BTCUSDT', '1m', 1404317098, 1404317947, '22879.51000000', 22893.08, '22924.00000000', '22878.79000000', '40.96413000', 850, True, '938183.75848050', '21.36854000', '489312.15504250', '0']), dict_values([1655158860000, 1655158919999, 'BTCUSDT', '1m', 1404317948, 1404318724, '22893.09000000', 22956.01, '22956.44000000', '22891.24000000', '63.86601000', 777, True, '1463919.25868270', '41.54481000', '952240.95172030', '0']), dict_values([1655158920000, 1655158979999, 'BTCUSDT', '1m', 1404318725, 1404319301, '22956.00000000', 22933.8, '22965.85000000', '22919.93000000', '44.51428000', 577, True, '1021240.49457000', '23.02147000', '528088.62926560', '0']), dict_values([1655158980000, 1655159039999, 'BTCUSDT', '1m', 1404319302, 1404319884, '22933.80000000', 22931.7, '22968.70000000', '22931.70000000', '45.61350000', 583, True, '1046812.91102910', '26.64999000', '611677.65235590', '0']), dict_values([1655159040000, 1655159099999, 'BTCUSDT', '1m', 1404319885, 1404320380, '22931.70000000', 22963.6, '22963.60000000', '22931.70000000', '34.83882000', 496, True, '799492.35718590', '18.58618000', '426554.59660540', '0']), dict_values([1655159100000, 1655159159999, 'BTCUSDT', '1m', 1404320381, 1404321238, '22963.60000000', 22892.96, '22963.60000000', '22876.00000000', '60.54357000', 858, True, '1386925.89195560', '24.43511000', '559689.23895810', '0']), dict_values([1655159160000, 1655159219999, 'BTCUSDT', '1m', 1404321239, 1404322044, '22892.97000000', 22933.73, '22935.24000000', '22884.23000000', '54.15429000', 806, True, '1240917.62282480', '30.19400000', '691888.47355070', '0']), dict_values([1655159220000, 1655159279999, 'BTCUSDT', '1m', 1404322045, 1404322602, '22933.72000000', 22898.51, '22933.73000000', '22893.90000000', '39.32474000', 558, True, '900940.80532370', '14.37294000', '329194.77291150', '0']), dict_values([1655159280000, 1655159339999, 'BTCUSDT', '1m', 1404322603, 1404323280, '22898.51000000', 22913.44, '22941.38000000', '22894.20000000', '55.27931000', 678, True, '1266958.25838750', '25.96788000', '595004.92060170', '0']), dict_values([1655159340000, 1655159399999, 'BTCUSDT', '1m', 1404323281, 1404323877, '22913.43000000', 22917.47, '22935.33000000', '22898.38000000', '41.89868000', 597, True, '959925.77624030', '29.32403000', '671776.08746880', '0']), dict_values([1655159400000, 1655159459999, 'BTCUSDT', '1m', 1404323878, 1404324629, '22917.46000000', 22926.14, '22940.54000000', '22905.09000000', '41.94238000', 752, True, '961422.87451060', '26.42760000', '605778.95583800', '0']), dict_values([1655159460000, 1655159519999, 'BTCUSDT', '1m', 1404324630, 1404325470, '22926.14000000', 22984.98, '22991.78000000', '22926.13000000', '60.67257000', 841, True, '1393438.12756220', '42.96396000', '986761.52631820', '0']), dict_values([1655159520000, 1655159579999, 'BTCUSDT', '1m', 1404325471, 1404326681, '22984.97000000', 23033.47, '23050.00000000', '22955.67000000', '130.39396000', 1211, True, '3001062.43655360', '94.51716000', '2175545.99495900', '0']), dict_values([1655159580000, 1655159639999, 'BTCUSDT', '1m', 1404326682, 1404327463, '23033.46000000', 23027.98, '23044.02000000', '23003.75000000', '75.82821000', 782, True, '1746055.03871380', '43.44432000', '1000274.87642370', '0']), dict_values([1655159640000, 1655159699999, 'BTCUSDT', '1m', 1404327464, 1404328127, '23027.98000000', 23050.0, '23050.00000000', '22989.71000000', '37.10304000', 664, True, '853700.07376310', '16.76559000', '385766.03804750', '0']), dict_values([1655159700000, 1655159759999, 'BTCUSDT', '1m', 1404328128, 1404328914, '23049.99000000', 23017.58, '23061.21000000', '23000.00000000', '63.41953000', 787, True, '1460376.88774500', '38.64706000', '889949.38050820', '0']), dict_values([1655159760000, 1655159819999, 'BTCUSDT', '1m', 1404328915, 1404329577, '23017.58000000', 23032.65, '23035.92000000', '22998.00000000', '37.52337000', 663, True, '863399.16851550', '20.42653000', '470001.99825760', '0']), dict_values([1655159820000, 1655159879999, 'BTCUSDT', '1m', 1404329578, 1404330656, '23032.65000000', 22970.0, '23032.66000000', '22967.92000000', '52.50759000', 1079, True, '1207313.67948460', '18.18598000', '417980.82412970', '0']), dict_values([1655159880000, 1655159939999, 'BTCUSDT', '1m', 1404330657, 1404331472, '22970.00000000', 22944.15, '22976.36000000', '22932.93000000', '45.61654000', 816, True, '1047110.82363790', '19.04629000', '437176.53676620', '0']), dict_values([1655159940000, 1655159999999, 'BTCUSDT', '1m', 1404331473, 1404332560, '22944.14000000', 22881.25, '22950.10000000', '22880.92000000', '87.22979000', 1088, True, '1999709.17279790', '28.44249000', '651935.67439020', '0']), dict_values([1655160000000, 1655160059999, 'BTCUSDT', '1m', 1404332561, 1404333755, '22881.26000000', 22934.96, '22967.83000000', '22877.55000000', '77.32469000', 1195, True, '1772010.82888970', '34.46055000', '789873.17261720', '0']), dict_values([1655160060000, 1655160119999, 'BTCUSDT', '1m', 1404333756, 1404334777, '22934.97000000', 22860.0, '22938.98000000', '22850.30000000', '74.97540000', 1022, True, '1715696.69742850', '34.45658000', '788553.07288340', '0']), dict_values([1655160120000, 1655160179999, 'BTCUSDT', '1m', 1404334778, 1404336315, '22859.99000000', 22831.25, '22880.36000000', '22817.94000000', '118.79537000', 1538, True, '2714093.32177620', '50.92161000', '1163278.68431070', '0']), dict_values([1655160180000, 1655160239999, 'BTCUSDT', '1m', 1404336316, 1404339258, '22831.24000000', 22826.77, '22831.25000000', '22746.00000000', '201.85042000', 2943, True, '4599391.80362510', '68.88236000', '1569332.03108110', '0']), dict_values([1655160240000, 1655160299999, 'BTCUSDT', '1m', 1404339259, 1404340378, '22826.77000000', 22785.06, '22859.93000000', '22768.00000000', '91.46640000', 1120, True, '2085925.94859210', '41.86745000', '954681.45051920', '0']), dict_values([1655160300000, 1655160359999, 'BTCUSDT', '1m', 1404340379, 1404341550, '22785.07000000', 22738.44, '22831.86000000', '22736.27000000', '79.54714000', 1172, True, '1811691.79661730', '37.69411000', '858550.11468520', '0']), dict_values([1655160360000, 1655160419999, 'BTCUSDT', '1m', 1404341551, 1404342789, '22739.50000000', 22763.53, '22773.95000000', '22714.64000000', '74.56308000', 1239, True, '1695633.17444380', '32.95206000', '749253.69815710', '0']), dict_values([1655160420000, 1655160479999, 'BTCUSDT', '1m', 1404342790, 1404344023, '22763.52000000', 22709.24, '22776.34000000', '22705.31000000', '99.38610000', 1234, True, '2260001.50092610', '39.27953000', '893022.53939750', '0']), dict_values([1655160480000, 1655160539999, 'BTCUSDT', '1m', 1404344024, 1404345747, '22709.23000000', 22723.42, '22738.04000000', '22695.52000000', '116.23014000', 1724, True, '2639303.11155010', '27.77412000', '630762.29791510', '0']), dict_values([1655160540000, 1655160599999, 'BTCUSDT', '1m', 1404345748, 1404347603, '22723.43000000', 22779.2, '22838.92000000', '22723.42000000', '154.25061000', 1856, True, '3516079.54655880', '92.70639000', '2113202.02078980', '0']), dict_values([1655160600000, 1655160659999, 'BTCUSDT', '1m', 1404347604, 1404348551, '22779.20000000', 22788.73, '22802.60000000', '22751.84000000', '47.07432000', 948, True, '1072557.00528300', '23.40196000', '533207.93226920', '0']), dict_values([1655160660000, 1655160719999, 'BTCUSDT', '1m', 1404348552, 1404349460, '22788.73000000', 22807.19, '22817.44000000', '22762.31000000', '43.89378000', 909, True, '1000490.61828830', '28.18924000', '642428.11127460', '0']), dict_values([1655160720000, 1655160779999, 'BTCUSDT', '1m', 1404349461, 1404350256, '22807.18000000', 22769.93, '22807.20000000', '22769.90000000', '39.86569000', 796, True, '908515.66840990', '15.79489000', '359922.91200430', '0']), dict_values([1655160780000, 1655160839999, 'BTCUSDT', '1m', 1404350257, 1404351376, '22769.92000000', 22715.01, '22769.93000000', '22699.52000000', '43.92497000', 1120, True, '998192.64892120', '19.94762000', '453277.36651050', '0']), dict_values([1655160840000, 1655160899999, 'BTCUSDT', '1m', 1404351377, 1404352264, '22715.01000000', 22712.53, '22758.72000000', '22707.29000000', '50.26424000', 888, True, '1142215.97702990', '24.39753000', '554391.87603360', '0']), dict_values([1655160900000, 1655160959999, 'BTCUSDT', '1m', 1404352265, 1404353795, '22712.53000000', 22685.43, '22729.08000000', '22674.96000000', '175.45667000', 1531, True, '3982847.59050140', '101.17339000', '2296572.06582070', '0']), dict_values([1655160960000, 1655161019999, 'BTCUSDT', '1m', 1404353796, 1404355204, '22685.44000000', 22679.33, '22716.47000000', '22672.52000000', '96.54945000', 1409, True, '2190545.57101780', '65.34944000', '1482500.01640870', '0']), dict_values([1655161020000, 1655161079999, 'BTCUSDT', '1m', 1404355205, 1404357396, '22679.34000000', 22653.67, '22691.48000000', '22621.00000000', '185.64879000', 2192, True, '4205443.49687010', '81.63688000', '1849457.22318460', '0']), dict_values([1655161080000, 1655161139999, 'BTCUSDT', '1m', 1404357397, 1404360250, '22653.67000000', 22594.63, '22653.67000000', '22588.04000000', '205.16262900', 2854, True, '4638513.18819120', '54.68343000', '1236367.11620320', '0']), dict_values([1655161140000, 1655161199999, 'BTCUSDT', '1m', 1404360251, 1404362021, '22594.63000000', 22587.9, '22623.88000000', '22563.00000000', '214.65710000', 1771, True, '4849078.89913920', '79.58019000', '1797886.83392730', '0']), dict_values([1655161200000, 1655161259999, 'BTCUSDT', '1m', 1404362022, 1404364882, '22587.90000000', 22550.67, '22650.00000000', '22531.47000000', '418.31063000', 2861, True, '9452401.70919863', '295.02957000', '6669692.10834940', '0']), dict_values([1655161260000, 1655161319999, 'BTCUSDT', '1m', 1404364883, 1404366957, '22550.68000000', 22541.28, '22604.42000000', '22531.00000000', '225.77619000', 2075, True, '5091789.04697609', '113.33875000', '2556527.10875570', '0']), dict_values([1655161320000, 1655161379999, 'BTCUSDT', '1m', 1404366958, 1404368926, '22541.28000000', 22531.19, '22548.80000000', '22517.52000000', '381.98672600', 1969, True, '8606118.38279308', '123.48899000', '2782061.55638880', '0']), dict_values([1655161380000, 1655161439999, 'BTCUSDT', '1m', 1404368927, 1404376499, '22534.02000000', 22460.24, '22556.09000000', '22441.92000000', '748.83059300', 7573, True, '16850919.96618268', '190.71774300', '4293301.43350342', '0']), dict_values([1655161440000, 1655161499999, 'BTCUSDT', '1m', 1404376500, 1404381700, '22460.24000000', 22378.46, '22470.77000000', '22358.05000000', '566.67624900', 5201, True, '12695983.27385382', '231.70253000', '5190956.94856510', '0']), dict_values([1655161500000, 1655161559999, 'BTCUSDT', '1m', 1404381701, 1404384104, '22378.46000000', 22430.08, '22527.03000000', '22358.05000000', '205.89604000', 2404, True, '4623482.72353670', '97.17435000', '2181752.97553160', '0']), dict_values([1655161560000, 1655161619999, 'BTCUSDT', '1m', 1404384105, 1404385533, '22424.88000000', 22389.07, '22500.00000000', '22387.00000000', '99.25171000', 1429, True, '2227368.41979580', '38.61943000', '866503.53066990', '0']), dict_values([1655161620000, 1655161679999, 'BTCUSDT', '1m', 1404385534, 1404387129, '22389.06000000', 22367.07, '22469.38000000', '22361.64000000', '116.47893000', 1596, True, '2610644.05005400', '52.13910000', '1168751.66666590', '0']), dict_values([1655161680000, 1655161739999, 'BTCUSDT', '1m', 1404387130, 1404389883, '22367.06000000', 22326.2, '22407.45000000', '22304.00000000', '249.88354400', 2754, True, '5583795.19886148', '97.14582000', '2170874.60985070', '0']), dict_values([1655161740000, 1655161799999, 'BTCUSDT', '1m', 1404389884, 1404391415, '22332.53000000', 22341.91, '22366.00000000', '22305.67000000', '187.15944000', 1532, True, '4181617.77892280', '111.04880000', '2481118.48427300', '0']), dict_values([1655161800000, 1655161859999, 'BTCUSDT', '1m', 1404391416, 1404392949, '22341.91000000', 22397.73, '22419.48000000', '22316.30000000', '116.94788000', 1534, True, '2616938.32104210', '61.24318000', '1370440.84621470', '0']), dict_values([1655161860000, 1655161919999, 'BTCUSDT', '1m', 1404392950, 1404394301, '22409.37000000', 22401.96, '22418.57000000', '22357.55000000', '78.78921000', 1352, True, '1764198.13764240', '30.55280000', '684137.66805040', '0']), dict_values([1655161920000, 1655161979999, 'BTCUSDT', '1m', 1404394302, 1404395974, '22401.96000000', 22319.92, '22419.00000000', '22306.69000000', '121.45062000', 1673, True, '2714615.57912610', '63.14287000', '1411421.10266470', '0']), dict_values([1655161980000, 1655162039999, 'BTCUSDT', '1m', 1404395975, 1404398533, '22319.92000000', 22270.61, '22337.65000000', '22257.02000000', '202.87394800', 2559, True, '4523433.63675642', '84.69914000', '1888552.16379210', '0']), dict_values([1655162040000, 1655162099999, 'BTCUSDT', '1m', 1404398534, 1404401747, '22270.61000000', 22222.97, '22273.00000000', '22205.00000000', '234.03245300', 3214, True, '5204894.52435373', '61.38948000', '1365479.60302870', '0']), dict_values([1655162100000, 1655162159999, 'BTCUSDT', '1m', 1404401748, 1404406289, '22222.98000000', 22166.0, '22259.49000000', '22136.90000000', '350.19032500', 4542, True, '7768988.11784427', '141.19902300', '3133203.37966440', '0']), dict_values([1655162160000, 1655162219999, 'BTCUSDT', '1m', 1404406290, 1404409555, '22166.01000000', 22141.16, '22175.61000000', '22100.98000000', '249.06334100', 3266, True, '5512092.77453397', '94.93267000', '2101095.43198710', '0']), dict_values([1655162220000, 1655162279999, 'BTCUSDT', '1m', 1404409556, 1404413071, '22134.09000000', 22066.07, '22141.16000000', '22055.00000000', '270.23765000', 3516, True, '5968563.69710020', '65.67607000', '1450324.57767680', '0']), dict_values([1655162280000, 1655162339999, 'BTCUSDT', '1m', 1404413072, 1404415497, '22066.07000000', 22157.56, '22186.07000000', '22043.70000000', '312.66163000', 2426, True, '6910007.32609270', '208.78129000', '4615412.18794090', '0']), dict_values([1655162340000, 1655162399999, 'BTCUSDT', '1m', 1404415498, 1404417997, '22157.55000000', 22285.43, '22317.20000000', '22157.55000000', '209.42026000', 2500, True, '4658744.76150130', '118.82430000', '2643585.37642030', '0']), dict_values([1655162400000, 1655162459999, 'BTCUSDT', '1m', 1404417998, 1404421051, '22285.43000000', 22389.58, '22458.42000000', '22282.36000000', '285.13168000', 3054, True, '6377922.09604720', '170.70076000', '3818099.12246840', '0']), dict_values([1655162460000, 1655162519999, 'BTCUSDT', '1m', 1404421052, 1404423724, '22389.58000000', 22415.3, '22490.00000000', '22384.38000000', '289.73747000', 2673, True, '6498178.85892840', '113.05828000', '2536339.78662260', '0']), dict_values([1655162520000, 1655162579999, 'BTCUSDT', '1m', 1404423725, 1404425588, '22415.31000000', 22362.31, '22443.48000000', '22362.31000000', '189.13982000', 1864, True, '4234772.88646410', '71.71076000', '1605674.60711290', '0'])]
# data = pd.DataFrame(x, columns=data_col)
print(data)

data['SMA 7'] = ta.trend.sma_indicator(data['c'], window=7)
data['sav gol'] = savgol_filter(data['c'], 25, 3)

sav_gol = data['sav gol'].shift(1)
p7 = data['SMA 7'].shift(1)

data['Pos Crossing'] = (data['sav gol'] >= data['SMA 7']) & (sav_gol <= p7)
data['Neg Crossing'] = (data['sav gol'] <= data['SMA 7']) & (sav_gol >= p7)

ticker = 'LTCUSDT'
wallet = {'USDT': 10000, ticker: 0}
fees = 0.9985

for index, row in data.iterrows():  #
    # buy / sell
    if row['Pos Crossing']:
        print('BUY')
        wallet[ticker] = (wallet['USDT'] / row['c']) * fees
        wallet['USDT'] = 0
    elif row['Neg Crossing']:
        print('SELL')
        if wallet[ticker] > 0:
            wallet['USDT'] = wallet[ticker] * row['c'] * fees
            wallet[ticker] = 0
    print(wallet)

if wallet[ticker] > 0:
    wallet['USDT'] = wallet[ticker] * data.iloc[-1]['c'] * fees
    wallet[ticker] = 0
print(wallet)